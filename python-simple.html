<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pythonç¼–ç¨‹ç¯å¢ƒ - åŸºç¡€ç‰ˆ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
</head>
<body class="bg-dark text-light">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <h3>Pythonä»£ç ç¼–è¾‘å™¨</h3>
                <div id="loadingStatus" class="alert alert-info">æ­£åœ¨åŠ è½½Pythonç¯å¢ƒ...</div>
                <textarea id="code" class="form-control"># PythonåŸºç¡€ç¼–ç¨‹ç¯å¢ƒ
print("Hello, Python!")

# ç¤ºä¾‹ï¼šè®¡ç®—å¹³å‡åˆ†
scores = [85, 92, 78, 96]
average = sum(scores) / len(scores)
print(f"å¹³å‡åˆ†: {average:.1f}")
</textarea>
                <div class="mt-3">
                    <button id="runBtn" class="btn btn-primary" onclick="runCode()" disabled>è¿è¡Œä»£ç </button>
                    <button class="btn btn-secondary" onclick="clearCode()">æ¸…ç©º</button>
                </div>
            </div>
            <div class="col-md-6">
                <h3>è¿è¡Œç»“æœ</h3>
                <pre id="output" class="bg-secondary p-3 text-light" style="min-height: 300px;">ç­‰å¾…ä»£ç è¿è¡Œ...</pre>
            </div>
        </div>
    </div>

    <script>
        let pyodide;
        let editor;

        // åˆå§‹åŒ–CodeMirror
        const codeTextarea = document.getElementById('code');
        editor = CodeMirror.fromTextArea(codeTextarea, {
            mode: 'python',
            theme: 'default',
            lineNumbers: true,
            indentUnit: 4
        });

        // åŠ è½½Pyodide
        async function main() {
            try {
                document.getElementById('loadingStatus').textContent = 'æ­£åœ¨åŠ è½½Pythonç¯å¢ƒ...';
                
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
                });
                
                // åŸºç¡€é…ç½®
                pyodide.runPython(`
import sys
from io import StringIO

class OutputCapture:
    def __init__(self):
        self.outputs = []
    
    def write(self, text):
        self.outputs.append(text)
    
    def flush(self):
        pass
    
    def get_output(self):
        result = ''.join(self.outputs)
        self.outputs = []
        return result

output_capture = OutputCapture()

def input(prompt=""):
    print(f"{prompt}[æ¨¡æ‹Ÿè¾“å…¥: ç”¨æˆ·]")
    return "ç”¨æˆ·"

print("ğŸ‰ Pythonç¯å¢ƒå·²å°±ç»ª!")
                `);
                
                document.getElementById('loadingStatus').innerHTML = 
                    '<div class="alert alert-success">âœ… Pythonç¯å¢ƒå·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ç¼–ç¨‹ï¼</div>';
                document.getElementById('runBtn').disabled = false;
                
            } catch (error) {
                console.error('PyodideåŠ è½½å¤±è´¥:', error);
                document.getElementById('loadingStatus').innerHTML = 
                    '<div class="alert alert-danger">âŒ Pythonç¯å¢ƒåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
            }
        }

        // è¿è¡Œä»£ç 
        async function runCode() {
            if (!pyodide) {
                alert('Pythonç¯å¢ƒæœªå‡†å¤‡å°±ç»ª');
                return;
            }

            const code = editor.getValue();
            const outputDiv = document.getElementById('output');
            
            try {
                // é‡å®šå‘è¾“å‡º
                pyodide.runPython(`
sys.stdout = output_capture
sys.stderr = output_capture
                `);
                
                // è¿è¡Œç”¨æˆ·ä»£ç 
                pyodide.runPython(code);
                
                // è·å–è¾“å‡º
                const output = pyodide.runPython('output_capture.get_output()');
                
                // æ¢å¤æ ‡å‡†è¾“å‡º
                pyodide.runPython(`
sys.stdout = sys.__stdout__
sys.stderr = sys.__stderr__
                `);
                
                // æ˜¾ç¤ºç»“æœ
                const timestamp = new Date().toLocaleTimeString();
                outputDiv.textContent = `[${timestamp}] è¿è¡Œå®Œæˆ:\n${output || '(æ— è¾“å‡º)'}`;
                
            } catch (error) {
                const timestamp = new Date().toLocaleTimeString();
                outputDiv.textContent = `[${timestamp}] è¿è¡Œé”™è¯¯:\n${error.message}`;
                outputDiv.style.color = '#ff6b6b';
            }
        }

        function clearCode() {
            editor.setValue('# åœ¨è¿™é‡Œç¼–å†™ä½ çš„Pythonä»£ç \nprint("Hello, World!")');
        }

        // å¯åŠ¨åº”ç”¨
        main();
    </script>
</body>
</html>
