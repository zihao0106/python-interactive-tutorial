<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <titl                    </div>
                </div>

                <!-- æ•°æ®ç®¡ç†ä¸­å¿ƒ -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h5>ğŸ“Š æ•°æ®ç®¡ç†ä¸­å¿ƒ</h5>
                    </div>
                    <div class="card-body">
                        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                        <div class="upload-section mb-3">
                            <h6>ğŸ“ ä¸Šä¼ æ‚¨çš„æ•°æ®æ–‡ä»¶</h6>
                            <div class="row">
                                <div class="col-md-8">
                                    <input type="file" class="form-control" id="fileInput" 
                                           accept=".txt,.csv,.json,.py" multiple
                                           title="æ”¯æŒ CSV, JSON, TXT, PY æ–‡ä»¶">
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-success w-100" onclick="processUploadedFiles()">
                                        ğŸ“¤ å¤„ç†ä¸Šä¼ æ–‡ä»¶
                                    </button>
                                </div>
                            </div>
                            <small class="text-muted">æ”¯æŒæ ¼å¼: CSV, JSON, TXT, PY | æœ€å¤§å•æ–‡ä»¶: 5MB</small>
                            <div id="uploadedFilesList" class="mt-2"></div>
                        </div>
                        
                        <!-- GitHubæ•°æ®åŒºåŸŸ -->
                        <div class="github-data-section mb-3">
                            <h6>ğŸ« GitHubé¢„è®¾æ•°æ®é›†</h6>
                            <div class="row">
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-outline-primary btn-sm w-100" onclick="loadAllGithubData()">
                                        ğŸ“š åŠ è½½å…¨éƒ¨
                                    </button>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-outline-info btn-sm w-100" onclick="loadStudentData()">
                                        ğŸ‘¥ å­¦ç”Ÿæ•°æ®
                                    </button>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-outline-warning btn-sm w-100" onclick="loadSalesData()">
                                        ğŸ’° é”€å”®æ•°æ®
                                    </button>
                                </div>
                                <div class="col-md-3 mb-2">
                                    <button class="btn btn-outline-secondary btn-sm w-100" onclick="loadWeatherData()">
                                        ğŸŒ¤ï¸ å¤©æ°”æ•°æ®
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ•°æ®æ“ä½œåŒºåŸŸ -->
                        <div class="data-operations">
                            <h6>ğŸ› ï¸ æ•°æ®æ“ä½œ</h6>
                            <div class="row">
                                <div class="col-md-4 mb-2">
                                    <button class="btn btn-outline-success btn-sm w-100" onclick="listAllData()">
                                        ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰æ•°æ®
                                    </button>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <button class="btn btn-outline-primary btn-sm w-100" onclick="showDataExamples()">
                                        ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹
                                    </button>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <button class="btn btn-outline-danger btn-sm w-100" onclick="clearAllUploadedData()">
                                        ğŸ—‘ï¸ æ¸…ç©ºä¸Šä¼ 
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">thonåœ¨çº¿ç¼–ç¨‹ç¯å¢ƒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <style>
        body {
            background: #f8f9fa;
        }
        .editor-container {
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .output-container {
            background: #1e1e1e;
            color: #fff;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .toolbar {
            background: #343a40;
            color: white;
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-ready {
            background: #28a745;
            color: white;
        }
        .status-loading {
            background: #ffc107;
            color: #212529;
        }
        .status-error {
            background: #dc3545;
            color: white;
        }
        .example-tabs {
            margin-bottom: 20px;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½è¦†ç›–å±‚ -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h5>æ­£åœ¨åŠ è½½Pythonç¯å¢ƒ...</h5>
            <p class="text-muted">é¦–æ¬¡åŠ è½½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œè¯·ç¨å€™</p>
            <div class="progress mt-3">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" id="loadingProgress"></div>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                ğŸ Pythonæ•™ç¨‹
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="index.html">
                    ğŸ  è¿”å›ä¸»é¡µ
                </a>
                <a class="nav-link" href="chapters/chapter1.html">
                    ğŸ“š æ•™ç¨‹
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div class="row">
            <!-- ä¾§è¾¹æ  -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h6>ğŸ“š ç¤ºä¾‹ä»£ç </h6>
                    </div>
                    <div class="card-body p-2">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary btn-sm" onclick="loadExample('hello')">
                                ğŸ‘‹ Hello World
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadExample('variables')">
                                ğŸ“ å˜é‡å’Œç±»å‹
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadExample('lists')">
                                ğŸ“‹ åˆ—è¡¨æ“ä½œ
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadExample('loops')">
                                ğŸ”„ å¾ªç¯æ§åˆ¶
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadExample('functions')">
                                âš¡ å‡½æ•°å®šä¹‰
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="loadExample('data')">
                                ğŸ“Š æ•°æ®åˆ†æ
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h6>ğŸ› ï¸ å·¥å…·</h6>
                    </div>
                    <div class="card-body p-2">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-secondary btn-sm" onclick="clearOutput()">
                                ğŸ—‘ï¸ æ¸…é™¤è¾“å‡º
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="clearEditor()">
                                ğŸ“„ æ¸…ç©ºç¼–è¾‘å™¨
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="downloadCode()">
                                ğŸ’¾ ä¸‹è½½ä»£ç 
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸»ç¼–è¾‘åŒº -->
            <div class="col-md-9">
                <div class="card">
                    <div class="toolbar">
                        <div>
                            <strong>ğŸ Pythonåœ¨çº¿ç¼–ç¨‹ç¯å¢ƒ</strong>
                            <span id="statusIndicator" class="status-indicator status-loading ms-2">åŠ è½½ä¸­...</span>
                        </div>
                        <div>
                            <button id="runBtn" class="btn btn-success btn-sm" onclick="runCode()" disabled>
                                â–¶ï¸ è¿è¡Œä»£ç  (Ctrl+Enter)
                            </button>
                        </div>
                    </div>
                    <div class="editor-container">
                        <textarea id="codeEditor"># æ¬¢è¿ä½¿ç”¨Pythonåœ¨çº¿ç¼–ç¨‹ç¯å¢ƒï¼
# åœ¨è¿™é‡Œç¼–å†™ä½ çš„Pythonä»£ç ï¼Œç„¶åç‚¹å‡»"è¿è¡Œä»£ç "æŒ‰é’®

print("Hello, Python World!")
print("è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿã€è½»é‡çº§çš„Pythonç¼–ç¨‹ç¯å¢ƒ")

# è¯•è¯•æ•°å­¦è®¡ç®—
result = 2 ** 10
print(f"2çš„10æ¬¡æ–¹æ˜¯: {result}")

# è¯•è¯•å¾ªç¯
for i in range(5):
    print(f"è®¡æ•°: {i + 1}")
</textarea>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <strong>ğŸ“‹ è¾“å‡ºç»“æœ</strong>
                        <button class="btn btn-outline-secondary btn-sm float-end" onclick="clearOutput()">æ¸…é™¤</button>
                    </div>
                    <div class="card-body p-0">
                        <div id="output" class="output-container">
                            ç‚¹å‡»"è¿è¡Œä»£ç "æŒ‰é’®æŸ¥çœ‹è¾“å‡ºç»“æœ...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è„šæœ¬åŠ è½½ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

    <script>
        let pyodide = null;
        let editor = null;
        let isReady = false;

        // ç¤ºä¾‹ä»£ç 
        const examples = {
            hello: `# Hello World ç¤ºä¾‹
print("Hello, Python World!")
print("æ¬¢è¿æ¥åˆ°Pythonç¼–ç¨‹ä¸–ç•Œï¼")

# ç®€å•çš„å˜é‡å’Œå­—ç¬¦ä¸²æ“ä½œ
name = "Pythonå­¦ä¹ è€…"
print(f"ä½ å¥½, {name}!")
print("è¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªPythonç¨‹åºï¼")`,

            variables: `# å˜é‡å’Œæ•°æ®ç±»å‹ç¤ºä¾‹
# å­—ç¬¦ä¸²
name = "Pythonå­¦ä¹ è€…"
message = f"æ¬¢è¿ä½ , {name}!"

# æ•°å­—
age = 25
height = 175.5
is_student = True

# æ‰“å°ä¿¡æ¯
print("ä¸ªäººä¿¡æ¯:")
print(f"å§“å: {name}")
print(f"å¹´é¾„: {age}")
print(f"èº«é«˜: {height}cm")
print(f"å­¦ç”Ÿèº«ä»½: {'æ˜¯' if is_student else 'ä¸æ˜¯'}å­¦ç”Ÿ")
print(f"å§“åç±»å‹: {type(name)}")
print(f"å¹´é¾„ç±»å‹: {type(age)}")`,

            lists: `# åˆ—è¡¨æ“ä½œç¤ºä¾‹
# åˆ›å»ºåˆ—è¡¨
fruits = ["è‹¹æœ", "é¦™è•‰", "æ©™å­", "è‘¡è„"]
numbers = [1, 2, 3, 4, 5]

print("æ°´æœåˆ—è¡¨:", fruits)
print("æ•°å­—åˆ—è¡¨:", numbers)

# åˆ—è¡¨æ“ä½œ
fruits.append("è‰è“")
print("æ·»åŠ è‰è“å:", fruits)

# åˆ—è¡¨æ¨å¯¼å¼
squares = [x**2 for x in numbers]
print("å¹³æ–¹æ•°:", squares)

# éå†åˆ—è¡¨
print("\\néå†æ°´æœ:")
for i, fruit in enumerate(fruits):
    print(f"{i+1}. {fruit}")`,

            loops: `# å¾ªç¯æ§åˆ¶ç¤ºä¾‹
print("=== forå¾ªç¯ç¤ºä¾‹ ===")
for i in range(1, 6):
    print(f"ç¬¬{i}æ¬¡å¾ªç¯")

print("\\n=== whileå¾ªç¯ç¤ºä¾‹ ===")
count = 1
while count <= 5:
    print(f"è®¡æ•°: {count}")
    count += 1

print("\\n=== åµŒå¥—å¾ªç¯ - ä¹˜æ³•è¡¨ ===")
for i in range(1, 4):
    for j in range(1, 4):
        result = i * j
        print(f"{i} Ã— {j} = {result}")
    print()  # ç©ºè¡Œ`,

            functions: `# å‡½æ•°å®šä¹‰ç¤ºä¾‹
def greet(name, age=18):
    """é—®å€™å‡½æ•°"""
    return f"ä½ å¥½ï¼Œ{name}ï¼ä½ ä»Šå¹´{age}å²ã€‚"

def calculate_area(length, width):
    """è®¡ç®—çŸ©å½¢é¢ç§¯"""
    area = length * width
    return area

def fibonacci(n):
    """ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—"""
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# ä½¿ç”¨å‡½æ•°
print(greet("å°æ˜"))
print(greet("å°çº¢", 20))

area = calculate_area(5, 3)
print(f"çŸ©å½¢é¢ç§¯: {area}")

print("\\næ–æ³¢é‚£å¥‘æ•°åˆ—å‰10é¡¹:")
for i in range(10):
    print(f"F({i}) = {fibonacci(i)}")`,

            data: `# æ•°æ®åˆ†æç¤ºä¾‹ï¼ˆä½¿ç”¨å†…ç½®åº“ï¼‰
import json
import math
from collections import Counter

# æ¨¡æ‹Ÿæ•°æ®
students = [
    {"name": "å¼ ä¸‰", "age": 20, "score": 85},
    {"name": "æå››", "age": 19, "score": 92},
    {"name": "ç‹äº”", "age": 21, "score": 78},
    {"name": "èµµå…­", "age": 20, "score": 88},
    {"name": "é’±ä¸ƒ", "age": 19, "score": 95}
]

print("å­¦ç”Ÿæ•°æ®åˆ†æ:")
print("=" * 30)

# åŸºæœ¬ç»Ÿè®¡
scores = [s["score"] for s in students]
avg_score = sum(scores) / len(scores)
max_score = max(scores)
min_score = min(scores)

print(f"å¹³å‡åˆ†: {avg_score:.2f}")
print(f"æœ€é«˜åˆ†: {max_score}")
print(f"æœ€ä½åˆ†: {min_score}")

# å¹´é¾„åˆ†å¸ƒ
ages = [s["age"] for s in students]
age_counter = Counter(ages)
print(f"\\nå¹´é¾„åˆ†å¸ƒ: {dict(age_counter)}")

# æˆç»©ç­‰çº§
print("\\næˆç»©ç­‰çº§:")
for student in students:
    score = student["score"]
    if score >= 90:
        grade = "ä¼˜ç§€"
    elif score >= 80:
        grade = "è‰¯å¥½"
    elif score >= 70:
        grade = "ä¸­ç­‰"
    else:
        grade = "éœ€è¦åŠªåŠ›"
    
    print(f"{student['name']}: {score}åˆ† - {grade}")`
        };

        // åˆå§‹åŒ–ç¼–è¾‘å™¨
        function initEditor() {
            editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
                mode: 'python',
                theme: 'monokai',
                lineNumbers: true,
                indentUnit: 4,
                lineWrapping: true,
                extraKeys: {
                    "Ctrl-Enter": runCode,
                    "Cmd-Enter": runCode
                }
            });
        }

        // åˆå§‹åŒ–Pyodide
        async function initPyodide() {
            try {
                updateProgress(20);
                updateStatus('loading', 'ä¸‹è½½Pythonç¯å¢ƒ...');
                
                console.log('å¼€å§‹åŠ è½½Pyodide...');
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
                });
                console.log('PyodideåŠ è½½æˆåŠŸ');
                
                updateProgress(40);
                updateStatus('loading', 'å®‰è£…å¿…è¦çš„åŒ…...');
                
                // å®‰è£…å¿…è¦çš„åŒ…
                try {
                    console.log('å¼€å§‹åŠ è½½åŒ…...');
                    await pyodide.loadPackage(["pandas", "numpy"]);
                    console.log('æ ¸å¿ƒåŒ…åŠ è½½æˆåŠŸ');
                    
                    // å°è¯•åŠ è½½matplotlibï¼ˆå¯é€‰ï¼‰
                    try {
                        await pyodide.loadPackage(["matplotlib"]);
                        console.log('å¯è§†åŒ–åŒ…åŠ è½½æˆåŠŸ');
                    } catch (matplotlibError) {
                        console.warn('matplotlibåŠ è½½å¤±è´¥ï¼Œè·³è¿‡å¯è§†åŒ–åŠŸèƒ½:', matplotlibError);
                    }
                } catch (packageError) {
                    console.warn('æ ¸å¿ƒåŒ…åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨åŸºç¡€PythonåŠŸèƒ½:', packageError);
                    updateStatus('loading', 'ä½¿ç”¨åŸºç¡€PythonåŠŸèƒ½...');
                }
                
                updateProgress(70);
                updateStatus('loading', 'é…ç½®Pythonç¯å¢ƒ...');
                
                console.log('å¼€å§‹é…ç½®Pythonç¯å¢ƒ...');
                // é…ç½®è¾“å‡ºé‡å®šå‘å’Œæ•°æ®ç®¡ç†åŠŸèƒ½
                pyodide.runPython(`
import sys
from io import StringIO

# å°è¯•å¯¼å…¥åŒ…ï¼Œå¦‚æœå¤±è´¥åˆ™æä¾›å‹å¥½æç¤º
try:
    import pandas as pd
    import numpy as np
    import matplotlib.pyplot as plt
    PACKAGES_AVAILABLE = True
    print("ğŸ“¦ æ•°æ®åˆ†æåŒ…å·²å‡†å¤‡å°±ç»ª")
except ImportError as e:
    PACKAGES_AVAILABLE = False
    print("âš ï¸ éƒ¨åˆ†æ•°æ®åˆ†æåŒ…æœªåŠ è½½ï¼ŒåŸºç¡€åŠŸèƒ½ä»å¯ä½¿ç”¨")
    print(f"è¯¦ç»†ä¿¡æ¯: {e}")

import urllib.request
import json

class OutputCapture:
    def __init__(self):
        self.outputs = []
    
    def write(self, text):
        self.outputs.append(text)
    
    def flush(self):
        pass
    
    def get_output(self):
        result = ''.join(self.outputs)
        self.outputs = []
        return result

output_capture = OutputCapture()

# ç®€å•çš„inputæ¨¡æ‹Ÿï¼Œç”¨äºé¿å…åœ¨æµè§ˆå™¨ä¸­çš„é˜»å¡é—®é¢˜
def input(prompt=""):
    print(f"{prompt}[æ¨¡æ‹Ÿè¾“å…¥: ç”¨æˆ·]")
    return "ç”¨æˆ·"

# å­˜å‚¨ä¸Šä¼ æ–‡ä»¶çš„å…¨å±€å­—å…¸
uploaded_files = {}

# GitHubæ•°æ®åŠ è½½å‡½æ•°
def load_github_data(filename, data_type='csv'):
    """
    ä»GitHubä»“åº“åŠ è½½æ•°æ®
    filename: æ–‡ä»¶å (å¦‚ 'students.csv')
    data_type: æ•°æ®ç±»å‹ ('csv', 'json', 'txt')
    """
    base_url = "https://raw.githubusercontent.com/adamhu/my-python-course/main/data/"
    url = base_url + filename
    
    try:
        if data_type == 'csv':
            if PACKAGES_AVAILABLE:
                return pd.read_csv(url)
            else:
                print("âŒ pandasæœªåŠ è½½ï¼Œæ— æ³•å¤„ç†CSVæ–‡ä»¶")
                return None
        elif data_type == 'json':
            response = urllib.request.urlopen(url)
            return json.loads(response.read().decode())
        elif data_type == 'txt':
            response = urllib.request.urlopen(url)
            return response.read().decode()
        else:
            print(f"âŒ ä¸æ”¯æŒçš„æ•°æ®ç±»å‹: {data_type}")
            return None
    except Exception as e:
        print(f"âŒ GitHubæ•°æ®åŠ è½½å¤±è´¥: {str(e)}")
        return None

# ä¸Šä¼ æ–‡ä»¶å¤„ç†å‡½æ•°
def load_uploaded_file(filename, data_type='csv'):
    """
    åŠ è½½å­¦ç”Ÿä¸Šä¼ çš„æ–‡ä»¶
    filename: æ–‡ä»¶å
    data_type: æ•°æ®ç±»å‹ ('csv', 'json', 'txt')
    """
    if filename not in uploaded_files:
        print(f"âŒ æ–‡ä»¶ '{filename}' æœªæ‰¾åˆ°ï¼Œè¯·å…ˆä¸Šä¼ æ–‡ä»¶")
        return None
    
    content = uploaded_files[filename]
    
    try:
        if data_type == 'csv':
            if PACKAGES_AVAILABLE:
                return pd.read_csv(StringIO(content))
            else:
                print("âŒ pandasæœªåŠ è½½ï¼Œæ— æ³•å¤„ç†CSVæ–‡ä»¶")
                return None
        elif data_type == 'json':
            return json.loads(content)
        elif data_type == 'txt':
            return content
        else:
            print(f"âŒ ä¸æ”¯æŒçš„æ•°æ®ç±»å‹: {data_type}")
            return None
    except Exception as e:
        print(f"âŒ æ–‡ä»¶è§£æå¤±è´¥: {str(e)}")
        return None

# æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æ•°æ®
def list_available_data():
    """æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„æ•°æ®æº"""
    print("ğŸ“Š å¯ç”¨æ•°æ®æº:")
    print("\\nğŸ« GitHubé¢„è®¾æ•°æ®é›†:")
    print("  - students.csv (å­¦ç”Ÿæˆç»©æ•°æ®)")
    print("  - sales.csv (é”€å”®æ•°æ®)")
    print("  - weather.json (å¤©æ°”æ•°æ®)")
    
    print("\\nğŸ“ å·²ä¸Šä¼ çš„æ–‡ä»¶:")
    if uploaded_files:
        for filename in uploaded_files.keys():
            size = len(uploaded_files[filename])
            print(f"  - {filename} ({size} å­—ç¬¦)")
    else:
        print("  (æš‚æ— ä¸Šä¼ æ–‡ä»¶)")
    
    print("\\nğŸ’¡ ä½¿ç”¨æ–¹æ³•:")
    print("  GitHubæ•°æ®: df = load_github_data('students.csv', 'csv')")
    print("  ä¸Šä¼ æ•°æ®: df = load_uploaded_file('my_data.csv', 'csv')")

# å¿«é€ŸåŠ è½½GitHubç¤ºä¾‹æ•°æ®
def load_sample_data():
    """åŠ è½½GitHubç¤ºä¾‹æ•°æ®é›†"""
    if not PACKAGES_AVAILABLE:
        print("âŒ pandasæœªåŠ è½½ï¼Œæ— æ³•åŠ è½½CSVæ•°æ®é›†")
        print("ğŸ’¡ ä½ ä»å¯ä»¥åŠ è½½JSONæ ¼å¼çš„å¤©æ°”æ•°æ®:")
        print("   weather_data = load_github_data('weather.json', 'json')")
        return
    
    print("ğŸ“Š æ­£åœ¨åŠ è½½GitHubç¤ºä¾‹æ•°æ®...")
    global df_students, df_sales, weather_data
    
    df_students = load_github_data('students.csv', 'csv')
    if df_students is not None:
        print("âœ… å­¦ç”Ÿæ•°æ®å·²åŠ è½½ä¸º: df_students")
    
    df_sales = load_github_data('sales.csv', 'csv')
    if df_sales is not None:
        print("âœ… é”€å”®æ•°æ®å·²åŠ è½½ä¸º: df_sales")
    
    weather_data = load_github_data('weather.json', 'json')
    if weather_data is not None:
        print("âœ… å¤©æ°”æ•°æ®å·²åŠ è½½ä¸º: weather_data")

print("ğŸ‰ æ•°æ®å¤„ç†åŠŸèƒ½å·²å°±ç»ª!")
print("ğŸ“‹ å¯ç”¨å‡½æ•°:")
print("  - load_github_data(filename, data_type)")
print("  - load_uploaded_file(filename, data_type)")
print("  - load_sample_data()")
print("  - list_available_data()")

# å¦‚æœpandasä¸å¯ç”¨ï¼Œæä¾›åŸºç¡€ç¤ºä¾‹æ•°æ®
if not PACKAGES_AVAILABLE:
    print("\\nğŸ’¡ pandasæœªåŠ è½½ï¼Œæä¾›åŸºç¡€æ•°æ®ç¤ºä¾‹:")
    print("   students_data = [{'name': 'å¼ ä¸‰', 'math': 95, 'chinese': 87}]")
    print("   å¯ä»¥ä½¿ç”¨åŸºç¡€Pythonè¿›è¡Œæ•°æ®å¤„ç†")
    
    # æä¾›åŸºç¡€ç¤ºä¾‹æ•°æ®
    students_data = [
        {'name': 'å¼ ä¸‰', 'math': 95, 'chinese': 87, 'english': 92},
        {'name': 'æå››', 'math': 78, 'chinese': 85, 'english': 90},
        {'name': 'ç‹äº”', 'math': 88, 'chinese': 93, 'english': 76}
    ]
    
    sales_data = [
        {'date': '2024-01-01', 'product': 'ç¬”è®°æœ¬ç”µè„‘', 'sales': 25, 'revenue': 125000},
        {'date': '2024-01-01', 'product': 'å°å¼æœº', 'sales': 15, 'revenue': 90000},
        {'date': '2024-01-02', 'product': 'ç¬”è®°æœ¬ç”µè„‘', 'sales': 22, 'revenue': 110000}
    ]
    
    print("âœ… åŸºç¡€ç¤ºä¾‹æ•°æ®å·²å‡†å¤‡: students_data, sales_data")
`);
                
                updateProgress(100);
                updateStatus('ready', 'Pythonç¯å¢ƒå°±ç»ª');
                
                console.log('Pythonç¯å¢ƒé…ç½®å®Œæˆ');
                isReady = true;
                document.getElementById('runBtn').disabled = false;
                hideLoading();
                
            } catch (error) {
                console.error('PyodideåŠ è½½å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.stack);
                updateStatus('error', `Pythonç¯å¢ƒåŠ è½½å¤±è´¥: ${error.message}`);
                hideLoading();
                
                // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
                document.getElementById('output').innerHTML = 
                    `<div class="alert alert-danger">
                        <h5>âŒ Pythonç¯å¢ƒåŠ è½½å¤±è´¥</h5>
                        <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                        <p><strong>å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ:</strong></p>
                        <ul>
                            <li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
                            <li>åˆ·æ–°é¡µé¢é‡è¯•</li>
                            <li>å°è¯•ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬: <a href="python-simple.html" class="text-decoration-none">python-simple.html</a></li>
                        </ul>
                    </div>`;
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percent) {
            document.getElementById('loadingProgress').style.width = percent + '%';
        }

        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStatus(status, text) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator status-${status}`;
            indicator.textContent = text;
        }

        // éšè—åŠ è½½è¦†ç›–å±‚
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // è¿è¡Œä»£ç 
        async function runCode() {
            if (!isReady) {
                alert('Pythonç¯å¢ƒè¿˜æœªå‡†å¤‡å°±ç»ªï¼Œè¯·ç¨å€™...');
                return;
            }

            const code = editor.getValue();
            const outputDiv = document.getElementById('output');
            
            try {
                // é‡å®šå‘è¾“å‡º
                pyodide.runPython(`
sys.stdout = output_capture
sys.stderr = output_capture
`);
                
                // è¿è¡Œç”¨æˆ·ä»£ç 
                pyodide.runPython(code);
                
                // è·å–è¾“å‡º
                const output = pyodide.runPython('output_capture.get_output()');
                
                // æ¢å¤æ ‡å‡†è¾“å‡º
                pyodide.runPython(`
sys.stdout = sys.__stdout__
sys.stderr = sys.__stderr__
`);
                
                // æ˜¾ç¤ºç»“æœ
                const timestamp = new Date().toLocaleTimeString();
                outputDiv.textContent = `[${timestamp}] è¿è¡Œå®Œæˆ:\\n${output || '(æ— è¾“å‡º)'}`;
                
            } catch (error) {
                const timestamp = new Date().toLocaleTimeString();
                outputDiv.textContent = `[${timestamp}] è¿è¡Œé”™è¯¯:\\n${error.message}`;
                outputDiv.style.color = '#ff6b6b';
            }
        }

        // åŠ è½½ç¤ºä¾‹ä»£ç 
        function loadExample(exampleName) {
            if (examples[exampleName]) {
                editor.setValue(examples[exampleName]);
            }
        }

        // æ¸…é™¤è¾“å‡º
        function clearOutput() {
            document.getElementById('output').textContent = 'è¾“å‡ºå·²æ¸…é™¤...';
            document.getElementById('output').style.color = '#fff';
        }

        // æ¸…ç©ºç¼–è¾‘å™¨
        function clearEditor() {
            editor.setValue('# åœ¨è¿™é‡Œç¼–å†™ä½ çš„Pythonä»£ç \nprint("Hello, World!")\nprint("æ¬¢è¿æ¥åˆ°Pythonç¼–ç¨‹ä¸–ç•Œï¼")');
        }

        // ä¸‹è½½ä»£ç 
        function downloadCode() {
            const code = editor.getValue();
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my_python_code.py';
            a.click();
            URL.revokeObjectURL(url);
        }

        // æ•°æ®ç®¡ç†ç›¸å…³åŠŸèƒ½
        function handleFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showMessage('âŒ è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶', 'error');
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶å¤§å° (é™åˆ¶5MB)
            if (file.size > 5 * 1024 * 1024) {
                showMessage('âŒ æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB', 'error');
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            const allowedTypes = ['.csv', '.json', '.txt'];
            const fileExtension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
            if (!allowedTypes.includes(fileExtension)) {
                showMessage('âŒ ä»…æ”¯æŒ CSVã€JSONã€TXT æ ¼å¼æ–‡ä»¶', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                
                // å°†æ–‡ä»¶å†…å®¹ä¼ é€’ç»™Pythonï¼ˆå¤„ç†å•å¼•å·è½¬ä¹‰ï¼‰
                const escapedContent = content.replace(/'/g, "\\'").replace(/\n/g, "\\n");
                
                pyodide.runPython(`
uploaded_files['${file.name}'] = '''${escapedContent}'''
print(f"âœ… æ–‡ä»¶ '{file.name}' ä¸Šä¼ æˆåŠŸ! ({len(uploaded_files['${file.name}'])} å­—ç¬¦)")
                `);
                
                updateOutput();
                showMessage(`âœ… æ–‡ä»¶ "${file.name}" ä¸Šä¼ æˆåŠŸ!`, 'success');
                updateFileList();
            };
            
            reader.onerror = function() {
                showMessage('âŒ æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
            };
            
            reader.readAsText(file);
        }
        
        function loadGitHubData(filename) {
            const dataType = filename.endsWith('.json') ? 'json' : 
                           filename.endsWith('.csv') ? 'csv' : 'txt';
            
            pyodide.runPython(`
data = load_github_data('${filename}', '${dataType}')
if data is not None:
    globals()['${filename.replace('.', '_')}'] = data
    print(f"âœ… GitHubæ•°æ® '{filename}' å·²åŠ è½½ä¸ºå˜é‡: ${filename.replace('.', '_')}")
    if hasattr(data, 'shape'):
        print(f"ğŸ“Š æ•°æ®ç»´åº¦: {data.shape}")
    elif isinstance(data, dict):
        print(f"ğŸ“Š æ•°æ®é”®: {list(data.keys())}")
`);
            updateOutput();
        }
        
        function loadSampleData() {
            pyodide.runPython(`load_sample_data()`);
            updateOutput();
        }
        
        function showDataList() {
            pyodide.runPython(`list_available_data()`);
            updateOutput();
        }
        
        function clearData() {
            pyodide.runPython(`
uploaded_files.clear()
print("ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶")
            `);
            updateOutput();
            updateFileList();
            showMessage('å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®', 'info');
        }
        
        function updateOutput() {
            // è·å–Pythonè¾“å‡ºå¹¶æ›´æ–°è¾“å‡ºåŒºåŸŸ
            const output = pyodide.runPython('output_capture.get_output()');
            if (output) {
                const outputDiv = document.getElementById('output');
                const timestamp = new Date().toLocaleTimeString();
                outputDiv.textContent = `[${timestamp}] ${output}`;
                outputDiv.style.color = '#fff';
            }
        }
        
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            
            // è·å–å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
            const fileNames = pyodide.runPython(`list(uploaded_files.keys())`);
            
            if (fileNames.length === 0) {
                fileList.innerHTML = '<small class="text-muted">æš‚æ— ä¸Šä¼ æ–‡ä»¶</small>';
            } else {
                fileList.innerHTML = fileNames.map(name => 
                    `<span class="badge bg-secondary me-1">${name}</span>`
                ).join('');
            }
        }
        
        function showMessage(message, type = 'info') {
            const messageDiv = document.getElementById('message');
            const alertClass = type === 'error' ? 'alert-danger' : 
                             type === 'success' ? 'alert-success' : 'alert-info';
            
            messageDiv.innerHTML = `<div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>`;
            
            // è‡ªåŠ¨éšè—æ¶ˆæ¯
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // åŠ è½½ç¤ºä¾‹ä»£ç æ¨¡æ¿
        function loadTemplate(type) {
            let template = '';
            
            switch(type) {
                case 'data-analysis':
                    template = `# æ•°æ®åˆ†æç¤ºä¾‹
# 1. åŠ è½½GitHubç¤ºä¾‹æ•°æ®
load_sample_data()

# 2. æŸ¥çœ‹å­¦ç”Ÿæ•°æ®
print(df_students.head())
print(df_students.describe())

# 3. ç®€å•åˆ†æ
print("\\nå„ç§‘ç›®å¹³å‡åˆ†:")
print(df_students.groupby('Subject')['Score'].mean())

# 4. å¯è§†åŒ–
import matplotlib.pyplot as plt
df_students.groupby('Subject')['Score'].mean().plot(kind='bar')
plt.title('å„ç§‘ç›®å¹³å‡åˆ†')
plt.ylabel('åˆ†æ•°')
plt.show()`;
                    break;
                    
                case 'file-upload':
                    template = `# æ–‡ä»¶ä¸Šä¼ å¤„ç†ç¤ºä¾‹
# 1. æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æ•°æ®
list_available_data()

# 2. åŠ è½½ä¸Šä¼ çš„CSVæ–‡ä»¶ (å‡è®¾æ–‡ä»¶åä¸º my_data.csv)
# df = load_uploaded_file('my_data.csv', 'csv')
# print(df.head())

# 3. åŠ è½½ä¸Šä¼ çš„JSONæ–‡ä»¶
# data = load_uploaded_file('my_data.json', 'json')
# print(data)`;
                    break;
                    
                case 'basic-python':
                    template = `# PythonåŸºç¡€ç¼–ç¨‹ç¤ºä¾‹
# 1. å˜é‡å’Œæ•°æ®ç±»å‹
name = "å¼ ä¸‰"
age = 18
grades = [85, 92, 78, 96]

print(f"å§“å: {name}, å¹´é¾„: {age}")
print(f"æˆç»©: {grades}")
print(f"å¹³å‡åˆ†: {sum(grades)/len(grades):.1f}")

# 2. å¾ªç¯å’Œæ¡ä»¶
for i, grade in enumerate(grades, 1):
    if grade >= 90:
        print(f"ç¬¬{i}é—¨è¯¾ç¨‹: {grade}åˆ† (ä¼˜ç§€)")
    elif grade >= 80:
        print(f"ç¬¬{i}é—¨è¯¾ç¨‹: {grade}åˆ† (è‰¯å¥½)")
    else:
        print(f"ç¬¬{i}é—¨è¯¾ç¨‹: {grade}åˆ† (éœ€åŠªåŠ›)")`;
                    break;
            }
            
            editor.setValue(template);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initEditor();
            initPyodide();
        });
    </script>
</body>
</html>
